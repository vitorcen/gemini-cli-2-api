
> gemini-cli-api-tests@0.1.0 test
> vitest basic.test.ts


 RUN  v3.2.4 /mnt/c/Work/mcp/gemini-cli/test

🚀 Starting a2a-server...
❌ Failed to connect to server: fetch failed
No test files found, exiting with code 1

filter: basic.test.ts
include: **/*.test.ts
exclude:  **/node_modules/**, **/dist/**, **/cypress/**, **/.{idea,git,cache,output,temp}/**, **/{karma,rollup,webpack,vite,vitest,jest,ava,babel,nyc,cypress,tsup,build,eslint,prettier}.config.*


⎯⎯⎯⎯⎯⎯ Unhandled Error ⎯⎯⎯⎯⎯⎯⎯
TypeError: fetch failed
 ❯ node:internal/deps/undici/undici:13510:13
 ❯ process.processTicksAndRejections node:internal/process/task_queues:105:5
 ❯ Object.setup setup.ts:40:28
     39| 
     40|   // 等待服务器启动
     41|   await new Promise((resolve) => setTimeout(resolve, 3000));
       |               ^
     42| 
     43|   // 验证服务器可用
 ❯ TestProject._initializeGlobalSetup node_modules/vitest/dist/chunks/cli-api.BkDphVBG.js:7074:21
 ❯ Vitest.initializeGlobalSetup node_modules/vitest/dist/chunks/cli-api.BkDphVBG.js:9724:35
 ❯ node_modules/vitest/dist/chunks/cli-api.BkDphVBG.js:9636:5
 ❯ Vitest.runFiles node_modules/vitest/dist/chunks/cli-api.BkDphVBG.js:9666:10
 ❯ Vitest.start node_modules/vitest/dist/chunks/cli-api.BkDphVBG.js:9554:18
 ❯ startVitest node_modules/vitest/dist/chunks/cli-api.BkDphVBG.js:10510:8
 ❯ start node_modules/vitest/dist/chunks/cac.Cb-PYCCB.js:1412:15

Caused by: Error: connect ECONNREFUSED 127.0.0.1:41242
 ❯ TCPConnectWrap.afterConnect [as oncomplete] node:net:1637:16

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
Serialized Error: { errno: -111, code: 'ECONNREFUSED', syscall: 'connect', address: '127.0.0.1', port: 41242 }



🛑 Stopping a2a-server...
✅ Server stopped
